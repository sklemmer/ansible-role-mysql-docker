---
# tasks file for ansible-role-mysql-docker
- name: Test if docker is installed
  command: docker
  register: result
  ignore_errors: True

- assert:
    that: result|success

- set_fact:
    exposed_port: "{{ [ mysql_port + '3306' ] if mysql_expose_port else [] }}"
    volumes: []
    image: '{{ mysql_image }}:{{ mysql_version }}'

# download mysql image
- name: Ensure mysql image exists
  docker_image:
    name: '{{ image }}'

# create mysql container
- assert:
    that: false == true

- name: Ensure mysql container is running
  docker_container:
    name: '{{ mysql_container_name }}'
    image: '{{ image }}'
    state: present
    ports: '{{ exposed_port }}'
    volumes: '{{ volumes }}'
    env:
      MYSQL_ROOT_PASSWORD: '{{ mysql_root_password }}'
